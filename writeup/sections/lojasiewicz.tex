\subsection{A condition for global convergence}\label{sec:Lojasiewicz_inequality}\manote{maybe discuss the optimality condition and provide simpler proof of convergence when kernel satisfies linearity assumption}
By \cref{prop:decay_mmd} we know that $t\mapsto\mathcal{F}(\nu_t)$ decreases, thus a natural question is to ask whether it converges to $0$. One strategy is to find an upper-bound on $\F(\nu_t)$ in terms of the absolute value of its time derivative, providing a differential inequality which can be solved using the Gronwall's lemma (see \cite{oguntuase2001inequality}). Such type of inequalities are known in the optimization literature as Lojasiewicz inequalities (see \cite{Bolte:2016}).
%This would provide a differential inequality which can be solved using the so called Gronwall's lemma. The solution of such inequality would be of the form $\F(\nu_t)\leq h(t)$ with $h(t)\rightarrow_{t\rightarrow \infty} 0$. Hence one can deduce the convergence of $\F(\nu_t)$ to the global minimizer and get estimates of the rate of convergence by means of $h(t)$.
According to \cref{prop:decay_mmd}, the absolute value of the time derivative of $\F(\nu_t)$ is given by $\int \Vert \nabla f_{\mu,\nu_t}(x) \Vert^2 \diff \nu_t(x)$. This is nothing but the squared \textit{weighted Sobolev semi-norm} of $f_{\mu,\nu_t}$ (see \cref{subsec:wasserstein_flow}) also denoted as $\Vert f_{\mu,\nu_t} \Vert_{\dot{H}(\nu_t)}$. Thus one needs to find a relationship between $\F(\nu_t) = \frac{1}{2} \Vert f_{\mu,\nu_t} \Vert_{\mathcal{H}}^2 $ and $\Vert f_{\mu,\nu_t} \Vert_{\dot{H}(\nu_t)}$. For this purpose, we consider the \textit{weighted negative Sobolev distance} on $\mathcal{P}_2(\X)$, defined by duality using $\Vert . \Vert_{\dot{H}(\nu)}$ (see also \cite{Peyre:2011}).
\begin{definition}\label{def:neg_sobolev}
	Let $\nu\in \mathcal{P}_2(\x)$ and its corresponding \textit{weighted Sobolev semi-norm} $ \Vert . \Vert_{\dot{H}(\nu)} $. %, defined on $L_2(\nu)$ the set of squared integrable functions w.r.t. $\nu$. 
	The \textit{weighted negative Sobolev distance} $\Vert p - q \Vert_{\dot{H}^{-1}(\nu)}$ between any $p$ and $q$ in $\mathcal{P}_2(\x)$  is defined as:
\begin{align}\label{eq:neg_sobolev}
	\Vert p - q \Vert_{\dot{H}^{-1}(\nu)} = \sup_{f\in L_2(\nu), \Vert f \Vert_{\dot{H}(\nu)} \leq 1 } \left\vert \int f(x)\diff p(x) - \int f(x)\diff q(x) \right\vert 
\end{align}	
with possibly infinite values.
\end{definition}
Equation \cref{eq:neg_sobolev} plays a fundamental role in dynamic optimal transport. %Indeed, when $q$ is equal to $\nu$, it linearizes the $W_2(p,\nu)$ as $p$ becomes arbitrarily close to $\nu$ \cite{Villani:2009,Otto:2000,Peyre:2011}. 
It can be seen as the minimum kinetic energy needed to advect the mass $\nu$ to $q$ (see \cite{mroueh2018regularized}). Whenever $\Vert \mu - \nu_t \Vert_{\dot{H}^{-1}(\nu_t)} $ is finite it is shown in \cref{proof:prop:lojasiewicz}) that:
\begin{align}\label{eq:inequality_neg_sobolev}
	\Vert f_{\mu,\nu_t} \Vert^2_{\mathcal{H}} \leq \Vert f_{\mu,\nu_t} \Vert_{\dot{H}(\nu_t)} \Vert  \mu -\nu_t\Vert_{\dot{H}^{-1}(\nu_t)}  
\end{align}
and provided that $\Vert \mu - \nu_t \Vert_{\dot{H}^{-1}(\nu_t)} $ remains bounded by some positive constant $C$ at all times, \cref{eq:inequality_neg_sobolev} leads to  a functional version of Lojasiewicz inequality for $\F$. 
%\begin{align}\label{eq:Lojasiewicz_inequality}
%	4\F(\nu_t)^2\leq C^2\frac{d \F(\nu_t)}{dt} \qquad \forall t\geq 0.
%\end{align} 
It is then possible to use the general strategy explained earlier to prove the convergence of the flow to a global optimum. This result is given in \cref{prop:lojasiewicz}:
\begin{proposition}\label{prop:lojasiewicz}
	Under \cref{assump:lipschitz_gradient_k} and  when $\Vert \mu - \nu_t \Vert^2_{\dot{H}^{-1}(\nu_t)} \leq C$, for all $t\geq 0$. Then:
	\begin{align}
	\mathcal{F}(\nu_t)\leq \frac{C}{C\mathcal{F}(\nu_0)^{-1} + 4t}
	\end{align}
\end{proposition}
The fact that \cref{eq:neg_sobolev} appears in the context of Wasserstein flows is not a coincidence. Indeed, \cref{eq:neg_sobolev} is a linearization of the Wasserstein distance (see \cite{Peyre:2011,Otto:2000} and \cref{subsec:wasserstein_flow}). In fact, gradient flows of $\F$ defined under different metrics, would involve other kinds of distances instead of \cref{eq:neg_sobolev}. 
 %\cref{eq:Lojasiewicz_inequality}. 
For instance, \cite{rotskoff2019global} consider gradient flows under a hybrid metric (a mixture between the Wasserstein distance and KL divergence). Convergence rates can then be obtained provided that the chi-square divergence $\chi^2(\mu\Vert \nu_t)$ remains bounded. As shown in \cref{subsec:Lojasiewicz_different_metrics}, $\chi^2(\mu\Vert \nu_t)^{\frac{1}{2}}$ turns out to linearize $KL(\mu\Vert \nu_t)^{\frac{1}{2}}$ when $\mu$ and $\nu_t$ are close. 

Under similar conditions as in \cref{prop:lojasiewicz}, convergence of $(\nu_n)$ defined in \cref{eq:euler_scheme} can be obtained:
\begin{proposition}\label{prop:discrete_lojasiewicz}
	Under \cref{assump:lipschitz_gradient_k} and when $\Vert \mu - \nu_n \Vert^2_{\dot{H}^{-1}(\nu_n)} \leq C$ for all $n\geq 0$. Then:
	\begin{align}
	\mathcal{F}(\nu_n)\leq \frac{C}{C\mathcal{F}(\nu_0)^{-1} + 4\gamma(1-\frac{3}{2}\gamma L) n}
	\end{align}
\end{proposition}
Proofs of \cref{prop:lojasiewicz,prop:discrete_lojasiewicz} are direct consequences of \cref{prop:decay_mmd,prop:decreasing_functional} and the bounded energy assumption, see  \cref{proof:prop:lojasiewicz} for a proof.
In practice, it is hard to guarantee that $\Vert \mu - \nu_t \Vert_{\dot{H}^{-1}(\nu_t)} $ remains bounded at all times. One possible approach could be to regularize $\F$ using an estimate of \cref{eq:neg_sobolev}. In fact \cite{Mroueh:2019} considers the gradient flow of a regularized version of the negative Sobolev distance which can be written in closed-form conveniently, and shows that this one decreases the MMD. Combing both losses could improve the overall convergence properties of the MMD for an additional computational cost. In the next Section, we propose a different approach to improve the convergence, and a particle-based algorithm to approximate the MMD flow in practice.
% but we first analyze in \cref{subsection:barrier_optimization} the case where $\F$ is only guaranteed to reach a barrier during optimization.
%All the difficulty is to see now when \cref{eq:bounded_neg_sobolev} holds. However, this quantity might be infinite \manote{say exactly when it is finite} and a fundamental problem would be to control its value during the evolution of the flow. One possible strategy would be to start from initial $\nu_0$ such that $\Vert \nu_0  - \mu \Vert_{\dot{H}^{-1}(\nu_0)} \leq C $  for some finite positive value $C$ and then show that this property is preserved during the dynamics. For instance, it would be satisfied if $\mu \ll \nu_0$ and if this remains true along the flow. Another view on the problem would be to consider a time depended constant $C_t$ in \cref{eq:bounded_neg_sobolev}, such that $	\lim_{t\rightarrow +\infty} \int_0^t C_s^{-1}\diff s = +\infty$.
%\begin{align}
%	\lim_{t\rightarrow +\infty} \int_0^t C_s^{-1}\diff s = +\infty
%\end{align}
%For instance $C_t$ could have up to a linear growth in time. In this case the decay of $\F(\nu_t)$ will no longer be in $\frac{1}{t}$ but only in $\frac{1}{\log(t)}$ \manote{This seems unlikely if we end up having convergence of $\nu_t$, but who nows.}. However, proving such results would be very involved and it is out of the scope of this study.
%One possible promising condition for \cref{eq:bounded_neg_sobolev} to hold would be if $\mu \ll \nu_0$ and if this property is preserved during the dynamics.


 








